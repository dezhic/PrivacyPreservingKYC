<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Government</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        .bd-callout {
            padding: 0.75rem;
            border: 1px solid #e9ecef;
            border-left-width: 0.25rem;
            border-radius: 0.25rem;
            border-left-color: green;
        }

        #copy-btn span {
            position: absolute;
            transform: translate(-50%, -50%);
        }

        .fade {
            transition: opacity 1s ease-in-out;
        }

        #conn-table-body td:nth-child(2),
        #conn-table-body td:nth-child(3) {
            word-break: break-all;
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand mx-3" href="#">Government</a>
        </div>
    </nav>

    <div class="container my-4" style="max-width: 80%">
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        Government Key Information
                    </div>
                    <div class="card-body">
                        <!-- <p><b>Public Key: </b>[
                            "893680c284f3225b85e847a3221bac0cca03045a045574652473405e21b906d0",
                            "67426c380f60a832c1c9ae3891d9c5d15d85837212b82784098af8281094e768"
                        ]</p> -->
                        <p><b>Public Key (Base64): </b>ODkzNjgwYzI4NGYzMjI1Yjg1ZTg0N2EzMjIxYmFjMGNjYTAzMDQ1YTA0NTU3NDY1MjQ3MzQwNWUyMWI5MDZkMCw2NzQyNmMzODBmNjBhODMyYzFjOWFlMzg5MWQ5YzVkMTVkODU4MzcyMTJiODI3ODQwOThhZjgyODEwOTRlNzY4</p>
                        <p><b>Private Key: </b><div id="priv-key">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</div></p>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-header">
                        Decrypt Parsed zkKYC Token
                    </div>
                    <div class="card-body">
                        <textarea type="text" class="form-control mb-3"
                            id="parsed-token" placeholder="Input the parsed zkKYC token here..."
                            style="height:300px;" wrap="off"></textarea>
                        <div class="row" style="display: flex; align-items: center; height:45px">
                            <div class="col-6" style="display:flex; justify-content: center;">
                                <button type="button" id="paste-token-btn" class="btn btn-success me-3"
                                    style="height: 40px; width: 160px">Paste</button>
                            </div>
                            <div class="col-6" style="display:flex; justify-content: center;">
                                <button type="button" id="decrypt-btn" class="btn btn-primary me-3"
                                    style="height: 40px; width: 160px">Decrypt</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        Decrypted Content
                    </div>
                    <div class="card-body">
                    <textarea id="decrypted-token" wrap="off" readonly class="form-control mb-3" style="width: 100%; height: 450px" placeholder="Token and proof parsing result will be displayed here."></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Credential Details Modal -->
    <div class="modal" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Credential Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="cred-modal-body" class="modal-body">
                    ...
                </div>
                <div>
                    <hr/>
                    <form class="container">
                        <div class="row mb-2">
                            <div class="col-6">
                                <label for="did-v" class="form-label">Verifier DID</label>
                                <input id="did-v" type="text" class="form-control" placeholder="DID_V">
                            </div>
                            <div class="col-6">
                                <label for="did-hv" class="form-label">Holder DID for Verifier</label>
                                <input id="did-hv" type="text" class="form-control" placeholder="DID_HV">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-8">
                                <label for="pub-g" class="form-label">Government Public Key</label>
                                <input id="pub-g" type="text" class="form-control" placeholder="Government Public Key">
                            </div>
                        </div>
                        <div class="row mx-5">
                            <div id="cred-store" hidden></div>
                            <button id="gen-token-btn" type=button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#zkkyc-token-modal">Generate zkKYC Token</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Understood</button> -->
                </div>
            </div>
        </div>
    </div>
    <!-- zkKYC Token Modal -->
    <div class="modal" id="zkkyc-token-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">zkKYC Token</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="zkkyc-modal-body" class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Back</button>
                    <!-- <button type="button" class="btn btn-primary">Understood</button> -->
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script>
        $("#paste-btn").click(() => {
            const clipboardText = navigator.clipboard.readText();
            clipboardText.then((text) => {
                $("#inv-url").val(text).change();
                $("#inv-url").focus();
            });

        });
        $("#decrypt-btn").click(() => {
            $.ajax({
                url: "/government/decrypt-token",
                type: "POST",
                data: JSON.stringify({
                    parsed_token: JSON.parse($("#parsed-token").val()),
                    priv_key: $("#priv-key").text()
                }),
                contentType: "application/json",
                success: (data) => {
                    console.log(data);
                    $("#decrypted-token").html(JSON.stringify(data, null, 2));
                },
                error: (xhr, ajaxOptions, thrownError) => {
                    alert(xhr.responseJSON.error);
                }
            })
        });

    </script>
</body>
</html>